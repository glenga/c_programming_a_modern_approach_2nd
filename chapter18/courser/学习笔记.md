# 第十八章 声明





###   存储期限

自动存储期限：变量在所属快被执行时获得内存单元，并在块终止时释放内存单元。

静态存储期限：变量在程序运行期间一直占用同一个内存单元，直到程序终止。



###  作用域

块作用域：从声明的地方开始，一直到块的末尾可见。

文件作用域：从声明的地方开始，一直到文件末尾可见。



###  链接

外部链接：变量可以被程序中的几个（或全部）文件共享。

内部链接：变量只能被所在文件中的函数共享(如果具有相同名字的变量出现在里另一个文件中，系统会把它作为不同的变量来处理)

无链接：变量在函数内部，不能被共享。



###  存储类型

存储类型一共有4种: `auto`, `static`, `extern`和`register`，在声明中最多可以出现一种存储类型。如果存储类型存在，则必须把它放置在最前面。

- `auto` 块内部默认的存储类型，因此是自动存储期限，无链接的。

- `static` 可以用于任何位置的变量。`static` 始终具有静态存储期限，变量所有的位置决定了变量的作用域和链接属性。

- `extern` 始终具有静态存储期限，作用域和链接属性依赖于变量声明的位置。

- `register` 常驻寄存器的变量，只对块变量有效，同`auto`。不能对register变量使用取地址操作符&。

   

### 类型限定符

`C89`只有两种类型限定符: `const`和`volatile`。`C99`还有一个限定符`restrict`。声明可以包含零个或多个限定符。



### 解释复杂声明

- 始终由内往外读声明符
- 始终使 [] 和 () 的优先级高于*

```c
int *(*x[10])(void);  // 函数指针数组，函数返回类型是int *
```

复杂的声明使用类型定义来简化：

```c
typedef int *Fn(void);
typedef Fn *Fn_ptr;
typedef Fn_ptr Fn_ptr_array[10];
typedef Fn_ptr_array x;
```



常用的几个复杂声明:

```c
int(*a)[]；             // 指针数组
int (*f)(int);         // 函数指针
int (*f(int))[];       // 函数返回指向数组的指针
int (*f(int))(int);    // 函数返回函数指针
int (*f[10])(int);     // 函数指针数组
```



### 内联函数

一般是使用频率高又比较短小公共函数。一般做法将内联定义放在头文件，然后在源文件中放入带有extern 关键字的原型声明。(这个是好像是反的) 原理是由于使用了extern 关键字，头文件中的定义在源文件中被认为是外部定义。

```c
// average.h
#ifndef AVERAGE_H
#define AVERAGE_H
inline double(double x, double y){
    return (x + y) / 2;
}
#endif
```

```c
// average.c
extern double(double x, double y);
```

在我们包含`#include "average.h"`时，预处理后会被直接替换为：

```c
...
extern double(double x, double y);
...
    
```

这样确保了内联函数的一致性。
